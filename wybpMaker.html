<html>
	<head>
		<title>wybpMaker</title>
		
		<style>
			/*button {
				margin-left: 8px;
				margin-bottom: 16px;
				margin-right: 8px;
				padding-left: 42px;
				padding-right: 42px;
				padding-top: 10.5;
				padding-bottom: 10.5;
			}*/
			
			.paraEdit {
				/*height: 40px;
				width: 120px;*/
				margin-left: 8px;
				margin-bottom: 16px;
			}
			
			.checkPass {
				display: inline-block;
				fill: rgb(248, 81, 73);
/* 				vertical-align: text-bottom; */
			}
			
			.checkFail {
				display: inline-block;
				fill: rgb(86, 211, 100);
/* 				vertical-align: text-bottom; */
			}
		</style>
		<link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  		<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
	</head>
	<body>
		<p>Reminder: You will need 3 paragraphs, with a recommended word count of 100-200 words per paragraph.</p>
		<style>
			#checkContainer p {
				display: inline;
			}
		</style>
		<div id="checkContainer">
			<p>Introduction word count: </p>
			<p id="introWordCount">Uninitialized</p>
			<span style="inline" id="introWordCountCheck"></span>
			<br/>
			<p>Paragraph 1 word count: </p>
			<p id="para1WordCount">Uninitialized</p>
			<span style="inline" id="para1WordCountCheck"></span>
			<br/>
			<p>Paragraph 2 word count: </p>
			<p id="para2WordCount">Uninitialized</p>
			<span style="inline" id="para2WordCountCheck"></span>
			<br/>
			<p>Paragraph 3 word count: </p>
			<p id="para3WordCount">Uninitialized</p>
			<span style="inline" id="para3WordCountCheck"></span>
			<br/>
			<p>Paragraph 4 word count: </p>
			<p id="para4WordCount">Uninitialized</p>
			<br/>
		</div>
		

		<form xmlns="http://www.w3.org/1999/xhtml" id="wybpMaker">
			<label class="mdc-text-field mdc-text-field--outlined" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__notch">
			      <span class="mdc-floating-label" id="my-label-id">What Ya Been Playing Week</span>
			    </span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <input type="text" class="mdc-text-field__input" id="titleEdit" name="Title" style="margin-left: 8px; margin-bottom: 16px" required="true" value="What Ya Been Playing Week " aria-labelledby="my-label-id">
			</label>
			<br>
			<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--no-label" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <span class="mdc-text-field__resizer">
			    <textarea id="introEdit" rows="10" cols="250" class="mdc-text-field__input" name="Intro" placeholder="Introduction (What you played)" required="true" wrap="soft" aria-label="Label"></textarea>
			  </span>
			</label>
			
			<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--no-label" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <span class="mdc-text-field__resizer">
			    <textarea id="para3Edit" rows="10" cols="250" class="mdc-text-field__input" name="Para3" placeholder="Why you played it" required="true" wrap="soft" aria-label="Label"></textarea>
			  </span>
			</label>
			
			<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--no-label" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <span class="mdc-text-field__resizer">
			    <textarea id="para1Edit" rows="10" cols="250" class="mdc-text-field__input" name="Para1" placeholder="What you liked about it and why" required="true" wrap="soft" aria-label="Label"></textarea>
			  </span>
			</label>
			
			<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--no-label" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <span class="mdc-text-field__resizer">
			    <textarea id="para2Edit" rows="10" cols="250" class="mdc-text-field__input" name="Para2" placeholder="What you didn't like about it and why" required="true" wrap="soft" aria-label="Label"></textarea>
			  </span>
			</label>
			
			<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--no-label" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-notched-outline">
			    <span class="mdc-notched-outline__leading"></span>
			    <span class="mdc-notched-outline__trailing"></span>
			  </span>
			  <span class="mdc-text-field__resizer">
			    <textarea id="para4Edit" rows="10" cols="250" class="mdc-text-field__input" name="Para4" placeholder="Extra" required="true" wrap="soft" aria-label="Label"></textarea>
			  </span>
			</label>
			<button class="mdc-button mdc-button--raised" id="submitBtn" type="button" name="Submit" style="margin-left: 8px; margin-bottom: 16px">
			  <span class="mdc-button__label">Done</span>
			</button>
			<button class="mdc-button mdc-button--raised" id="clearBtn" type="button" name="Clear" style="display: none;" disabled>
			  <span class="mdc-button__ripple"></span>
  			  <span class="mdc-button__label">Outlined Button</span>
			</button>
		</form>
		
		<!-- If word count ever breaks, stop using this and use a local copy of an older version from septemberish! -->
		<script src="https://catz1301.catz.gq/Countable.js" crossOrigin="anonymous">
		<script>
			var wybpForm = document.getElementById("wybpMaker");
			var minWordCount = "/125";
			let components = [].map.call(document.querySelectorAll('.mdc-text-field'), function(el) {
			  return new mdc.textField.MDCTextField(el);
			});
			var title = components[0];
			var intro = components[1];
			var para1 = components[2];
			var para2 = components[3];
			var para3 = components[4];
			var para4 = components[5];
			var submit = document.getElementById("submitBtn");
			var clearBtn = document.getElementById("clearBtn");
			submit.onclick = preSubmit;
			wybpForm.onsubmit = meow();
			
			Countable.on(intro, counter => {updateIntroWC(counter)});
			clearBtn.onclick = clearFields;
			function checkValues() {
				let validValues = true;
				if (title.value == "What Ya Been Playing Week ")
					validValues = false;
				if (intro.value == "")
					validValues = false;
				if (para1.value == "")
					validValues = false;
				if (para2.value == "")
					validValues = false;
				if (para3.value == "")
					validValues = false;
				if (para4.value == "")
					validValues = false;
				return validValues;
			}
			
			function clearFields() {
				title.value = "";
				intro.value = "";
				para1.value = "";
				para2.value = "";
				para3.value = "";
				para4.value = "";
				clearBtn.style.display = "none";
				clearBtn.enabled = false;
			}
			
			function meow() {
				if (checkValues()) {
					writeDocument(true);
				}
			}
			
			function preSubmit() {
				if (title.value != "What Ya Been Playing Week ")
					meow();
			}
			
			function writeDocument(notLoading) {
				alert("l");
				let rtfTemplate = [
					"{\\rtf1\\ansi\\ansicpg1252\\deff0\\nouicompat\\deflang1033{\\fonttbl{\\f0\\fnil\\fcharset0 Calibri;}}",
					"{\\*\\generator Riched20 10.0.18362}\\viewkind4\\uc1 ",
					"\\pard\\sa200\\sl480\\slmult1\\qc\\f0\\fs32\\lang9\\par",
					"[TITLE]\\par",
					"",
					"\\pard\\fi540\\sa200\\sl276\\slmult1\\fs22 [INTRODUCTION]\\par",
					"[PARA1]\\par",
					"",
					"\\pard\\sa200\\sl276\\slmult1\\tx540\\tab [PARA2]\\par",
					"\\tab [PARA3]\\par",
					"\\tab [PARA4]\\par",
					"\\par",
					"[SIGNATURE]\\par",
					"}"
				];
				
				let rtfTitle = rtfTemplate[3].replace("[TITLE]", title.value);
				let rtfIntro = rtfTemplate[5].replace("[INTRODUCTION]", intro.value);
				let rtfPara1 = rtfTemplate[6].replace("[PARA1]", para3.value);
				let rtfPara2 = rtfTemplate[8].replace("[PARA2]", para1.value);
				let rtfPara3 = rtfTemplate[9].replace("[PARA3]", para2.value);
				let rtfPara4 = rtfTemplate[10].replace("[PARA4]", para4.value);
				let rtfStr = rtfTemplate[0] + "\n" + rtfTemplate[1] + "\n" + rtfTemplate[2] + "\n" + rtfTitle + "\n" + rtfTemplate[4] + "\n" + rtfIntro + "\n" + rtfPara1 + "\n" + rtfTemplate[7] + "\n" + rtfPara2 + "\n" + rtfPara3 + "\n" + rtfPara4;
				let rtfFileName = title.value + ".rtf";
				
				let confirmDownload = confirm("Would you like to save this as " + rtfFileName + "?");
				if (confirmDownload) {
					let blob = new Blob([rtfStr]);
					let file = new File([blob], rtfFileName);
					let dlFile = document.createElement("a");
					dlFile.href = URL.createObjectURL(file);
					dlFile.download = file.name;
					dlFile.id = "downloadFileBtn";
					document.body.append(dlFile);
					document.getElementById("downloadFileBtn").click();
				}
				clearBtn.style.display = "inline-block";
				clearBtn.enabled = true;
			}
			
			function updateIntroWC(counterObj) { // WC short for 'word count'
				console.log(counterObj);
				let wcStatus = document.getElementById('introWordCount');
				let wordCOunt = -1;
				if (counterObj) {
					wcStatus.innerText = counterObj.words + minWordCount;
					wordCount = counterObj.words;
				} else {
					wcStatuc.innerText = "0" + minWordCount;
					wordCount = 0;
				}
				
				if (wordCount < parseInt(minWordCount.substr(1))) {
					setCheckResultFail(document.getElementById('introWordCountCheck'));
				} else {
					setCheckResultPass(document.getElementById('introWordCountCheck'));
				}
			}
			
			function setCheckResultPass(element) {
				element.innerHTML = '<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" role="img" class="checkPass"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>';
			}
			
			function setCheckResultFail(element) {
				element.innerHTML = '<svg class="checkFail" viewBox="0 0 16 16" version="1.1" width="16" height="16" role="img"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>';
			}
		</script>
	</body>
</html>
